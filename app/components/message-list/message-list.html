<div class="list">
  <div ng-repeat="messageGroup in messageList.groupedMessages
    track by messageGroup[0].id">
    <div class="row" ng-class="{
      'balanced-bg': messageGroup[0].sender !== messageList.userInfo.id,
      'calm-bg': messageGroup[0].sender === messageList.userInfo.id
    }"></div>
    <div class="item item-avatar">
      <img src="http://cdn.libravatar.org/avatar/{{
        messageGroup[0].sender === messageList.userInfo.id ?
        messageList.userInfo.id :
        messageList.contacts[messageGroup[0].sender].userInfo.id | limitTo:32
      }}?d=identicon" alt="Avatar for  {{
        messageGroup[0].sender === messageList.userInfo.id ?
        messageList.userInfo.email :
        messageList.contacts[messageGroup[0].sender].userInfo.email
      }}" />
      <h2>{{
        messageGroup[0].sender === messageList.userInfo.id ?
        'You' :
        messageList.contacts[messageGroup[0].sender].userInfo.displayName
      }} at {{
        messageGroup[0].sender === messageList.userInfo.id ?
        messageGroup[0].sentTime : messageGroup[0].receivedTime |
        date : 'short'
      }}</h2>
      <p ng-repeat="message in messageGroup track by message.id">
        {{message.content}}
      </p>
    </div>
  </div>
</div>
